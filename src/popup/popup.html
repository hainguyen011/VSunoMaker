<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suno Hit-Maker AI</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Syncopate:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="../lib/lucide.min.js"></script>
    <link rel="stylesheet" href="popup.css">
</head>

<body>
    <div class="studio-container">
        <header>
            <div class="logo">VSUNO<span>Maker</span></div>
            <div class="pulse-indicator"></div>
        </header>

        <nav class="tab-bar">
            <button class="tab-btn active" data-tab="compose" title="S√°ng t√°c">
                <i data-lucide="music"></i>
            </button>
            <button class="tab-btn" data-tab="assistants" title="Tr·ª£ l√Ω AI (Co-Producer)">
                <i data-lucide="message-square"></i>
            </button>
            <button class="tab-btn" data-tab="studio" title="Studio">
                <i data-lucide="audio-lines"></i>
            </button>
            <button class="tab-btn" data-tab="history" title="L·ªãch s·ª≠">
                <i data-lucide="clock"></i>
            </button>
            <button class="tab-btn" data-tab="settings" title="C√†i ƒë·∫∑t">
                <i data-lucide="settings"></i>
            </button>
        </nav>

        <main>
            <!-- TAB: COMPOSE -->
            <div id="tab-compose" class="tab-content active">
                <div class="input-panel">
                    <!-- Compose Control Card -->
                    <div class="compose-control-card">
                        <div class="mode-segmented-control">
                            <div class="segmented-slider"></div>
                            <button class="seg-btn active" data-mode="concept" id="seg-btn-concept">√ù T∆Ø·ªûNG</button>
                            <button class="seg-btn" data-mode="lyrics" id="seg-btn-lyrics">L·ªúI NH·∫†C</button>
                            <!-- Hidden toggle for compatibility -->
                            <input type="checkbox" id="input-mode-toggle" style="display: none;">
                        </div>

                        <div class="pro-toggle-wrapper" title="Ch·∫ø ƒë·ªô nh·∫°c kh√¥ng l·ªùi (Instrumental)">
                            <span class="pro-toggle-label">Inst</span>
                            <label class="pro-switch">
                                <input type="checkbox" id="instrumental-mode">
                                <span class="pro-slider"></span>
                            </label>
                        </div>

                        <div class="pro-toggle-wrapper"
                            title="B·∫≠t ƒë·ªÉ lo·∫°i b·ªè c√°c k√Ω hi·ªáu nh·ªãp ƒëi·ªáu (... v√† -) gi√∫p l·ªùi nh·∫°c s·∫°ch h∆°n">
                            <span class="pro-toggle-label">Clean Ly</span>
                            <label class="pro-switch">
                                <input type="checkbox" id="clean-lyrics-mode">
                                <span class="pro-slider"></span>
                            </label>
                        </div>
                    </div>



                    <div class="inspector-tools" style="margin-bottom: 10px; display: flex; gap: 8px;">
                        <!-- <button class="icon-btn" id="preview-lyrics" title="üëÅÔ∏è Xem tr∆∞·ªõc (Preview Rendered)">Xem
                            tr∆∞·ªõc</button> -->
                        <button class="icon-btn" id="magic-polish" title="S·ª≠a l·ªùi v·∫ßn ƒëi·ªáu (Magic Polish)">S·ª≠a l·ªùi
                            nh·∫°c</button>
                        <button class="icon-btn" id="inspect-lyrics" title="Scan v√πng Lyrics">Lyrics</button>
                        <button class="icon-btn" id="inspect-style" title="Scan v√πng Style">Styles</button>
                    </div>

                    <div class="lyrics-container-wrapper">
                        <label style="margin-bottom: 12px; display: block;" id="input-label" class="absolute-label">√ù
                            T∆Ø·ªûNG (CONCEPT)</label>
                        <textarea id="lyrics-input"
                            placeholder="V√≠ d·ª•: M·ªôt b√†i ballad V-pop t√¢m tr·∫°ng, n√≥i v·ªÅ s·ª± nu·ªëi ti·∫øc trong nh·ªØng ƒë√™m m∆∞a..."
                            style="text-align: left; min-height: 350px; padding-top: 50px; margin-bottom: 0;"></textarea>
                        <div id="lyrics-resizer" class="resize-handle"></div>
                        <div id="lyrics-render-preview" class="lyrics-render-preview" style="display: none;"></div>
                    </div>

                    <label>NGH·ªÜ Sƒ® TRUY·ªÄN C·∫¢M H·ª®NG</label>
                    <input type="text" id="artist-input" placeholder="V√≠ d·ª•: S∆°n T√πng M-TP..."
                        style="color: white; margin-bottom: 20px; ">

                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <div style="flex: 1;">
                            <label>NG√îN NG·ªÆ</label>
                            <select id="vocal-language"
                                style="width: 100%; padding: 10px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; color: white; font-size: 0.85rem; outline: none;">
                                <option value="Vietnamese">Ti·∫øng Vi·ªát</option>
                                <option value="English">Ti·∫øng Anh</option>
                                <option value="Korean">Ti·∫øng H√†n</option>
                                <option value="Japanese">Ti·∫øng Nh·∫≠t</option>
                                <option value="Chinese">Ti·∫øng Trung</option>
                                <option value="Thai">Ti·∫øng Th√°i</option>
                                <option value="French">Ti·∫øng Ph√°p</option>
                                <option value="Spanish">Ti·∫øng T√¢y Ban Nha</option>
                            </select>
                        </div>
                        <div style="flex: 1;" id="region-container">
                            <label>V√ôNG MI·ªÄN</label>
                            <select id="vocal-region"
                                style="width: 100%; padding: 10px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; color: white; font-size: 0.85rem; outline: none;">
                                <option value="Standard">Chu·∫©n</option>
                                <option value="Northern">Mi·ªÅn B·∫Øc</option>
                                <option value="Central">Mi·ªÅn Trung</option>
                                <option value="Southern">Mi·ªÅn Nam</option>
                            </select>
                        </div>
                        <div style="flex: 1;">
                            <label>GI·ªöI T√çNH (VOCAL)</label>
                            <select id="vocal-gender"
                                style="width: 100%; padding: 10px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; color: white; font-size: 0.85rem; outline: none;">
                                <option value="Random">Ng·∫´u nhi√™n</option>
                                <option value="Male Vocals">Nam (Male)</option>
                                <option value="Female Vocals">N·ªØ (Female)</option>
                                <option value="Duet Vocals">Song ca (Duet)</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <div style="flex: 1;">
                            <label>TR·ªåNG T√ÇM</label>
                            <select id="music-focus"
                                style="width: 100%; padding: 10px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; color: white; font-size: 0.85rem; outline: none;">
                                <option value="balanced">C√¢n b·∫±ng</option>
                                <option value="lyrics">∆Øu ti√™n L·ªùi</option>
                                <option value="music">∆Øu ti√™n Nh·∫°c</option>
                                <option value="fusion">Ph·ªëi h·ª£p</option>
                            </select>
                        </div>
                        <div style="flex: 1;">
                            <label>NH·ªäP ƒêI·ªÜU (RHYTHM)</label>
                            <select id="rhythm-flow"
                                style="width: 100%; padding: 10px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; color: white; font-size: 0.85rem; outline: none;">
                                <option value="default">M·∫∑c ƒë·ªãnh</option>
                                <option value="ballad">Ch·∫≠m & Ng√¢n (Ballad)</option>
                                <option value="rap">D·ªìn d·∫≠p (Rap/Rock)</option>
                                <option value="pop">Ng·∫Øt ngh·ªâ Tinh t·∫ø (Pop)</option>
                                <option value="epic">M·∫°nh m·∫Ω (Epic)</option>
                            </select>
                        </div>
                    </div>

                    <div class="vibe-selector">
                        <div class="vibe-chip active" data-vibe="V-Pop Viral">V-Pop Viral</div>
                        <div class="vibe-chip" data-vibe="Indie Chill">Indie Chill</div>
                        <div class="vibe-chip" data-vibe="Vinahouse Hit">Vinahouse</div>
                        <div class="vibe-chip" data-vibe="US-UK Modern">US-UK Pop</div>
                        <div class="vibe-chip" data-vibe="K-Pop Star">K-Pop</div>
                        <div class="vibe-chip" data-vibe="Lofi HipHop">Lo-fi</div>
                        <div class="vibe-chip" data-vibe="EDM Festival">EDM</div>
                        <div class="vibe-chip" data-vibe="Rock Ballad">Rock</div>
                    </div>

                    <div class="input-panel custom-vibe-panel premium-style-accent">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <label style="margin-bottom: 0;">VIBE T√ôY CH·ªàNH (CUSTOM)</label>
                            <div class="premium-button-group">
                                <button id="auto-style-btn" class="mini-auto-btn premium"
                                    title="ü§ñ AI High-Analysis: Ph√¢n t√≠ch s√¢u nh·ªãp ƒëi·ªáu & c·∫£m x√∫c ƒë·ªÉ t·∫°o Style">Auto
                                    AI</button>
                            </div>
                        </div>
                        <input type="text" id="custom-vibe-input" placeholder="V√≠ d·ª•: Bolero, Jazz, Funk...">
                        <div class="premium-badge-info">
                            <i data-lucide="sparkles" style="width: 10px; height: 10px;"></i>
                            AI s·∫Ω ph√¢n t√≠ch l·ªùi nh·∫°c ƒë·ªÉ ƒë·ªìng b·ªô nh·ªãp ƒëi·ªáu
                        </div>
                    </div>
                </div>

                <div class="action-zone">
                    <button id="compose-btn" class="glow-button">
                        T·∫†O HIT NGAY
                    </button>
                </div>
            </div>

            <!-- TAB: HISTORY -->
            <div id="tab-history" class="tab-content">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border);">
                    <label style="margin: 0;">L·ªäCH S·ª¨ G·∫¶N ƒê√ÇY</label>
                    <button class="icon-btn clear-btn" id="btn-clear-history"
                        style="font-size: 0.65rem; padding: 4px 10px;">X√ìA T·∫§T C·∫¢</button>
                </div>
                <div class="history-list" id="history-container">
                    <div class="empty-state">Ch∆∞a c√≥ l·ªãch s·ª≠ s√°ng t√°c.</div>
                </div>
            </div>

            <!-- TAB: ASSISTANTS (LAUNCHER MODE) -->
            <div id="tab-assistants" class="tab-content">
                <div class="assistants-lobby">
                    <div class="lobby-header">
                        <div class="lobby-title">TR·ª¢ L√ù √ÇM NH·∫†C</div>
                        <p class="lobby-subtitle">Ch·ªçn m·ªôt nh√¢n c√°ch AI ƒë·ªÉ b·∫Øt ƒë·∫ßu c·ªông t√°c tr·ª±c ti·∫øp tr√™n trang Suno.
                        </p>
                    </div>

                    <div id="assistants-grid" class="assistants-grid">
                        <!-- Assistant Cards will be injected here -->
                    </div>

                    <button id="btn-add-assistant-pro" class="add-assistant-card">
                        <div class="plus-icon">+</div>
                        <span>Th√™m Tr·ª£ l√Ω M·ªõi</span>
                    </button>
                </div>

                <!-- Modal: Assistant Editor (Keep this in popup) -->
                <div id="assistant-editor-modal" class="modal-overlay" style="display: none;">
                    <div class="modal-card">
                        <div class="modal-header">
                            <div class="modal-title">C·∫§U H√åNH TR·ª¢ L√ù</div>
                            <button class="close-modal" id="close-assistant-editor">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="input-panel">
                                <label>T√äN TR·ª¢ L√ù</label>
                                <input type="text" id="edit-assistant-name" placeholder="V√≠ d·ª•: Producer Ballad">
                            </div>
                            <div class="input-panel">
                                <label>NH√ÇN C√ÅCH (SYSTEM PROMPT)</label>
                                <textarea id="edit-assistant-prompt"
                                    placeholder="M√¥ t·∫£ vai tr√≤ c·ªßa tr·ª£ l√Ω..."></textarea>
                            </div>
                            <div class="input-panel">
                                <label>GEMINI API KEY (RI√äNG)</label>
                                <input type="password" id="edit-assistant-key"
                                    placeholder="B·ªè tr·ªëng ƒë·ªÉ d√πng Key m·∫∑c ƒë·ªãnh">
                            </div>
                            <div class="input-panel">
                                <label>MODEL</label>
                                <select id="edit-assistant-model">
                                    <option value="gemini-2.0-flash">Gemini 2.0 Flash (Nhanh)</option>
                                    <option value="gemini-2.0-pro-exp-02-05">Gemini 2.0 Pro (Th√¥ng minh)</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="btn-save-assistant" class="glow-button">L∆ØU C·∫§U H√åNH</button>
                            <button id="btn-delete-assistant" class="ghost-btn danger">X√ìA TR·ª¢ L√ù</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: SETTINGS -->
            <div id="tab-settings" class="tab-content">
                <div class="settings-container" style="display: flex; flex-direction: column; gap: 16px;">

                    <!-- API Key Section -->
                    <div class="input-panel" style="margin-bottom: 0;">
                        <label>GEMINI API KEY</label>
                        <div style="position: relative;">
                            <input type="password" id="api-key" placeholder="Nh·∫≠p API Key c·ªßa b·∫°n..."
                                style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: white; font-size: 0.8rem; padding-right: 35px;">
                            <button id="toggle-api-visibility" class="icon-btn"
                                style="position: absolute; right: 4px; top: 50%; transform: translateY(-50%); background: transparent; border: none; padding: 4px;">
                                <i data-lucide="eye" style="width: 14px; height: 14px; opacity: 0.5;"></i>
                            </button>
                        </div>
                        <div style="font-size: 0.65rem; color: var(--text-dim); margin-top: 6px; font-style: italic;">
                            * Key c·ªßa b·∫°n ƒë∆∞·ª£c l∆∞u c·ª•c b·ªô tr√™n tr√¨nh duy·ªát.
                        </div>
                    </div>

                    <!-- Model Selection Section -->
                    <div class="input-panel" style="margin-bottom: 0;">
                        <label> PHI√äN B·∫¢N M√î H√åNH (MODEL)</label>
                        <div style="display: flex; gap: 8px;">
                            <select id="gemini-model" default="gemini-2.5-flash"
                                style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: white; font-size: 0.85rem; outline: none; cursor: pointer;">
                                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                <option value="gemini-3-flash">Gemini 3 Flash</option>
                                <option value="gemini-3-pro">Gemini 3 Pro</option>
                            </select>
                        </div>
                        <button id="btn-check-models" class="glow-button"
                            style="margin-top: 12px; font-size: 0.75rem; padding: 10px; background: linear-gradient(90deg, #fa5656, #ff8e8e);">
                            C·∫≠p nh·∫≠t danh s√°ch Model
                        </button>
                    </div>

                    <!-- About / Info -->
                    <div class="input-panel"
                        style="margin-bottom: 0; background: rgba(255, 255, 255, 0.02); border: 1px solid var(--border); padding: 12px; border-radius: 12px;">
                        <label>TH√îNG TIN</label>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px;">
                            <span>Phi√™n b·∫£n:</span>
                            <span style="color: white; font-weight: 600;">1.3.0 - Pro</span>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; color: var(--text-secondary);">
                            <span>Tr·∫°ng th√°i:</span>
                            <span style="color: var(--success-color); font-weight: 600;">Stable</span>
                        </div>

                    </div>
                    <div class="author-card-horizontal">
                        <div class="author-details">
                            <div class="author-label">Developer</div>
                            <h3 class="author-name">Richard Nguyen</h3>
                            <p class="author-sub">H·∫£i Nguy·ªÖn</p>

                            <a href="https://buymeacoffee.com/hainguyen02" target="_blank" class="btn-donate-mini">
                                <img src="https://res.cloudinary.com/piperflow-cloud/image/upload/v1769360989/images_mfpub3.png"
                                    alt="BMC">
                                <span>Buy me a coffee</span>
                            </a>
                        </div>

                        <div class="qr-section">
                            <div class="qr-box">
                                <img src="https://res.cloudinary.com/piperflow-cloud/image/upload/v1769360734/bmc_qr_1_uzcg7w.png"
                                    alt="QR">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: STUDIO (Previously Advanced) -->
            <div id="tab-studio" class="tab-content">
                <!-- Sub-tab Navigation -->
                <div class="sub-tab-bar">
                    <button class="sub-tab-btn active" data-subtab="basic">C∆† B·∫¢N</button>
                    <button class="sub-tab-btn" data-subtab="pro">N√ÇNG CAO (PRO)</button>
                </div>

                <!-- 1. STUDIO BASIC CONTENT -->
                <div id="studio-basic-content" class="sub-tab-content active">
                    <!-- 1.1. Custom Persona -->
                    <div class="studio-accordion expanded">
                        <div class="accordion-header">
                            <label>NH√ÇN C√ÅCH AI (PERSONA)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">T√πy ch·ªânh vai tr√≤ v√† phong c√°ch s√°ng t√°c ri√™ng cho AI.</p>
                            <textarea id="custom-system-prompt"
                                placeholder="V√≠ d·ª•: B·∫°n l√† Hit-Maker chuy√™n d√≤ng nh·∫°c Vinahouse..."
                                style="min-height: 80px; font-size: 0.75rem; margin: 0;"></textarea>
                        </div>
                    </div>

                    <!-- 1.2. Structure Builder (Professional Hierarchical) -->
                    <div class="studio-accordion expanded">
                        <div class="accordion-header">
                            <label>C·∫§U TR√öC (STRUCTURE)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">S·∫Øp x·∫øp c·∫•u tr√∫c b√†i h√°t v·ªõi 40+ variants chuy√™n nghi·ªáp.</p>

                            <!-- Structure Display Area -->
                            <!-- Structure Display Container (Wrapper) -->
                            <div class="structure-container">
                                <div id="structure-display" class="structure-content">
                                    <span class="placeholder-text">Ch∆∞a ch·ªçn c·∫•u tr√∫c...</span>
                                </div>
                                <button class="struct-btn clear-btn" id="clear-structure" title="X√≥a t·∫•t c·∫£">√ó</button>
                            </div>

                            <!-- Tooltip Container -->
                            <div id="structure-tooltip" class="structure-tooltip"></div>

                            <!-- Structure Controls with Dropdowns -->
                            <div class="structure-controls-grid">
                                <!-- Intro Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Intro">
                                        <span class="category-icon"></span>
                                        <span>Intro</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Intro"></div>
                                </div>

                                <!-- Verse Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Verse">
                                        <span class="category-icon"></span>
                                        <span>Verse</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Verse"></div>
                                </div>

                                <!-- Pre-Chorus Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Pre-Chorus">
                                        <span class="category-icon"></span>
                                        <span>Pre-Chorus</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Pre-Chorus"></div>
                                </div>

                                <!-- Chorus Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Chorus">
                                        <span class="category-icon"></span>
                                        <span>Chorus</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Chorus"></div>
                                </div>

                                <!-- Post-Chorus Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Post-Chorus">
                                        <span class="category-icon"></span>
                                        <span>Post-Chorus</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Post-Chorus"></div>
                                </div>

                                <!-- Bridge Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Bridge">
                                        <span class="category-icon"></span>
                                        <span>Bridge</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Bridge"></div>
                                </div>

                                <!-- Drop Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Drop">
                                        <span class="category-icon"></span>
                                        <span>Drop</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Drop"></div>
                                </div>

                                <!-- Breakdown/Interlude Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Breakdown-Interlude">
                                        <span class="category-icon"></span>
                                        <span>Break/Interlude</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Breakdown-Interlude"></div>
                                </div>

                                <!-- Outro/End Category -->
                                <div class="structure-category">
                                    <button class="category-btn" data-category="Outro-End">
                                        <span class="category-icon"></span>
                                        <span>Outro/End</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="category-dropdown" data-category="Outro-End"></div>
                                </div>

                                <!-- Clear All Button moved to display area -->
                            </div>
                        </div>
                    </div>

                    <!-- 1.3. See The Sound (Image to Music) -->
                    <div class="studio-accordion">
                        <div class="accordion-header">
                            <label>SEE THE SOUND (NH√åN L√Ä NGHE)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">Ph√¢n t√≠ch h√¨nh ·∫£nh ƒë·ªÉ g·ª£i √Ω √Ω t∆∞·ªüng v√† phong c√°ch √¢m nh·∫°c.</p>
                            <div class="image-upload-box" id="image-upload-box">
                                <span id="image-upload-text">K√©o th·∫£ ho·∫∑c Click ƒë·ªÉ t·∫£i ·∫£nh</span>
                                <input type="file" id="image-input" accept="image/*" style="display: none;">
                            </div>
                            <div id="image-preview-container" class="image-preview-box" style="display: none;">
                                <img id="image-preview" src="" alt="Preview">
                                <button id="btn-remove-image" class="remove-img-btn">√ó</button>
                            </div>

                            <!-- Suggestions Result Box -->
                            <div id="sts-result-box" class="suggestion-box" style="display: none;">
                                <div class="suggestion-content">
                                    <div class="suggestion-item">
                                        <span class="suggestion-label">CONCEPT:</span>
                                        <p id="sts-concept-text">...</p>
                                    </div>
                                    <div class="suggestion-item">
                                        <span class="suggestion-label">VIBE:</span>
                                        <p id="sts-vibe-text">...</p>
                                    </div>
                                </div>
                                <button id="btn-apply-sts" class="action-btn">S√ÅNG T√ÅC V·ªöI √ù T∆Ø·ªûNG N√ÄY</button>
                            </div>
                        </div>
                    </div>

                    <!-- 1.4. Hear The Sound (Audio to Music) -->
                    <div class="studio-accordion">
                        <div class="accordion-header">
                            <label>HEAR THE SOUND (NGHE L√Ä HI·ªÇU)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">Ph√¢n t√≠ch file MP3 ƒë·ªÉ tr√≠ch xu·∫•t l·ªùi, phong c√°ch v√† nh·∫°c ƒëi·ªáu.</p>
                            <div class="image-upload-box" id="audio-upload-box">
                                <span id="audio-upload-text">K√©o th·∫£ ho·∫∑c Click ƒë·ªÉ t·∫£i file MP3</span>
                                <input type="file" id="audio-input" accept="audio/*" style="display: none;">
                            </div>
                            <div id="audio-preview-container" class="image-preview-box"
                                style="display: none; height: auto; padding: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px; width: 100%;">
                                    <i data-lucide="music" style="color: var(--accent);"></i>
                                    <span id="audio-file-name"
                                        style="font-size: 0.75rem; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1;">filename.mp3</span>
                                    <button id="btn-remove-audio" class="remove-img-btn"
                                        style="position: static;">√ó</button>
                                </div>
                            </div>

                            <!-- Audio Suggestions Result Box -->
                            <div id="hts-result-box" class="suggestion-box" style="display: none;">
                                <div class="suggestion-content">
                                    <div class="suggestion-item">
                                        <span class="suggestion-label">TITLE:</span>
                                        <p id="hts-title-text">...</p>
                                    </div>
                                    <div class="suggestion-item">
                                        <span class="suggestion-label">VIBE/STYLE:</span>
                                        <p id="hts-style-text">...</p>
                                    </div>
                                    <div class="suggestion-item">
                                        <span class="suggestion-label">LYRICS:</span>
                                        <p id="hts-lyrics-text"
                                            style="max-height: 100px; overflow-y: auto; font-size: 0.7rem; line-height: 1.4;">
                                            ...</p>
                                    </div>
                                </div>
                                <button id="btn-apply-hts" class="action-btn">S√ÅNG T√ÅC D·ª∞A TR√äN FILE N√ÄY</button>
                                <button id="btn-suggest-lyrics-hts" class="action-btn"
                                    style="margin-top: 8px; background: var(--accent); color: white ; border: none;">VI·∫æT
                                    L·ªúI M·ªöI CHO BEAT</button>
                            </div>
                        </div>
                    </div>

                    <!-- 1.5. Style Fusion -->
                    <div class="studio-accordion">
                        <div class="accordion-header">
                            <label>STYLE FUSION (LAI T·∫†O)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">H√≤a tr·ªôn hai th·ªÉ lo·∫°i nh·∫°c ƒë·ªÉ t·∫°o ra phong c√°ch ƒë·ªôc b·∫£n.</p>
                            <div style="display: flex; gap: 6px; margin-bottom: 8px;">
                                <input type="text" id="style-a" placeholder="Style 1 (V-Pop)"
                                    style="flex: 1; font-size: 0.75rem;">
                                <input type="text" id="style-b" placeholder="Style 2 (Jazz)"
                                    style="flex: 1; font-size: 0.75rem;">
                            </div>
                            <button class="action-btn" id="btn-fuse-style">LAI T·∫†O STYLE</button>
                        </div>
                    </div>

                    <!-- 1.6. Clone The Vibe -->
                    <div class="studio-accordion">
                        <div class="accordion-header">
                            <label>CLONE THE VIBE (SAO CH√âP)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">T√¨m ki·∫øm vibes t·ª´ b√†i h√°t y√™u th√≠ch c·ªßa b·∫°n</p>
                            <textarea id="clone-input" placeholder="D√°n l·ªùi b√†i h√°t ho·∫∑c m√¥ t·∫£ b√†i h√°t g·ªëc..."
                                style="min-height: 80px; font-size: 0.75rem; margin-bottom: 8px;"></textarea>
                            <button class="action-btn" id="btn-clone-vibe" style="margin-bottom: 12px;">D·ªäCH NG∆Ø·ª¢C
                                STYLE</button>

                            <div id="clone-result-box" class="result-box" style="display: none;">
                                <div class="result-header">K·∫æT QU·∫¢ GI·∫¢I M√É:</div>
                                <div id="clone-result-text" class="result-text"></div>
                                <div class="result-actions">
                                    <button class="mini-btn" id="btn-copy-clone">Sao ch√©p</button>
                                    <button class="mini-btn success" id="btn-apply-clone">D√πng s√°ng t√°c</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. STUDIO PRO (ADVANCED) CONTENT -->
                <div id="studio-pro-content" class="sub-tab-content">
                    <!-- 2.1. Vocal Lab -->
                    <div class="studio-accordion">
                        <div class="accordion-header">
                            <label>üéôÔ∏è VOCAL LAB (PH√íNG THU)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">ƒêi·ªÅu ch·ªânh ƒë·∫∑c t√≠nh v√† hi·ªáu ·ª©ng gi·ªçng h√°t chuy√™n s√¢u.</p>

                            <div class="pro-group">
                                <span class="pro-label">ƒê·∫∂C TR∆ØNG GI·ªåNG</span>
                                <div class="pro-grid-3" id="vocal-traits">
                                    <div class="pro-chip" data-val="Bright">S√°ng</div>
                                    <div class="pro-chip" data-val="Deep">Tr·∫ßm</div>
                                    <div class="pro-chip" data-val="Husky">Kh√†n</div>
                                    <div class="pro-chip" data-val="Soft">Nh·∫π</div>
                                    <div class="pro-chip" data-val="Powerful">M·∫°nh</div>
                                    <div class="pro-chip" data-val="Vibrant">Rung</div>
                                </div>
                            </div>

                            <div class="pro-group">
                                <span class="pro-label">HI·ªÜU ·ª®NG (PRESETS)</span>
                                <div class="pro-grid" id="vocal-presets">
                                    <div class="pro-chip" data-val="Studio recording">Studio</div>
                                    <div class="pro-chip" data-val="Live concert">Live</div>
                                    <div class="pro-chip" data-val="Auto-tune">Auto-tune</div>
                                    <div class="pro-chip" data-val="Lo-fi">Lo-fi</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2.2. Emotion Map -->
                    <div class="studio-accordion">
                        <div class="accordion-header">
                            <label>üé≠ EMOTION MAP (C·∫¢M X√öC)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">Ch·ªçn c·∫£m x√∫c ch·ªß ƒë·∫°o ƒë·ªÉ AI ƒëi·ªÅu ch·ªânh giai ƒëi·ªáu.</p>
                            <div class="pro-grid-3" id="emotion-chips">
                                <div class="pro-chip" data-val="Epic & Dramatic">K·ªãch t√≠nh</div>
                                <div class="pro-chip" data-val="Happy & Uplifting">H·∫°nh ph√∫c</div>
                                <div class="pro-chip" data-val="Sad & Melancholic">U s·∫ßu</div>
                                <div class="pro-chip" data-val="Chill & Relaxing">B√¨nh y√™n</div>
                                <div class="pro-chip" data-val="Dark & Aggressive">Gi·∫≠n d·ªØ</div>
                                <div class="pro-chip" data-val="Mysterious">B√≠ ·∫©n</div>
                            </div>
                        </div>
                    </div>

                    <!-- 2.3. Sonic Architect -->
                    <div class="studio-accordion">
                        <div class="accordion-header">
                            <label>üéπ SONIC ARCHITECT (KI·∫æN TR√öC)</label>
                            <div class="accordion-icon">‚ñº</div>
                        </div>
                        <div class="accordion-body">
                            <p class="feature-intro">Thi·∫øt k·∫ø d√†n nh·∫°c v√† kh√¥ng gian √¢m thanh chuy√™n s√¢u.</p>

                            <div class="pro-group">
                                <span class="pro-label">INSTRUMENTATION (D√ÄN NH·∫†C)</span>
                                <div class="pro-grid-3" id="instrument-chips">
                                    <div class="pro-chip" data-val="Vintage Keys">Vintage Keys</div>
                                    <div class="pro-chip" data-val="Cinematic Brass">Brass</div>
                                    <div class="pro-chip" data-val="808 Bass Sub">808 Bass</div>
                                    <div class="pro-chip" data-val="Moog Synth">Moog</div>
                                    <div class="pro-chip" data-val="Real Strings Section">Strings</div>
                                    <div class="pro-chip" data-val="Acoustic Percussion">Percussion</div>
                                </div>
                            </div>

                            <div class="pro-group">
                                <span class="pro-label">AUDIO ENGINEERING (MIX)</span>
                                <div class="pro-grid" id="engineering-chips">
                                    <div class="pro-chip" data-val="Wide Stereo Image">Wide Stereo</div>
                                    <div class="pro-chip" data-val="Analog Tape Warmth">Analog Warmth</div>
                                    <div class="pro-chip" data-val="Bitcrushed Lo-fi">Bitcrushed</div>
                                    <div class="pro-chip" data-val="Sidechain Compression">Sidechain</div>
                                    <div class="pro-chip" data-val="Large Cathedral Reverb">Ethereal</div>
                                    <div class="pro-chip" data-val="Distorted Grit">Grit</div>
                                </div>
                            </div>

                            <div class="pro-group">
                                <span class="pro-label">ENERGY PROFILE (NƒÇNG L∆Ø·ª¢NG)</span>
                                <div class="pro-grid-3" id="energy-chips">
                                    <div class="pro-chip" data-val="Explosive Burst">Burst</div>
                                    <div class="pro-chip" data-val="Crescendo Build-up">Crescendo</div>
                                    <div class="pro-chip" data-val="Steady Continuous Energy">Steady</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Fixed Global Status Log -->
        <div id="status-log-container" class="log-overlay">
            <div class="floating-log-card">
                <div class="log-scanline"></div>
                <div class="log-header">
                    <span class="log-badge">SYSTEM COMMAND CENTER</span>
                    <div class="log-dots"><span></span><span></span><span></span></div>
                </div>
                <div id="status-log" class="floating-log"></div>
            </div>
        </div>

        <!-- REVIEW MODAL (Lyrics Polish Review) -->
        <div id="polish-review-modal" class="modal-overlay" style="display: none;">
            <div class="modal-card">
                <div class="modal-header">
                    <div class="modal-title">
                        B·∫¢N CH·ªàNH S·ª¨A
                    </div>
                    <button class="modal-close" id="close-review">√ó</button>
                </div>
                <div class="modal-body">
                    <p class="review-intro">H√£y duy·ªát qua c√°c ƒë·ªÅ xu·∫•t thay ƒë·ªïi ƒë·ªÉ b√†i h√°t tr√¥i ch·∫£y h∆°n.</p>
                    <div id="review-list" class="review-list">
                        <!-- Review items will be injected here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="apply-all-review" class="glow-button">√ÅP D·ª§NG T·∫§T C·∫¢</button>
                    <button id="discard-all-review" class="ghost-btn">B·ªé QUA T·∫§T C·∫¢</button>
                </div>
            </div>
        </div>

        <footer>
            <span>AI MUSIC ENGINE v1.3</span>
            <span id="ai-status">ONLINE</span>
        </footer>
    </div>

    <!-- Modal: Work Details -->
    <div id="work-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title">
                    <i data-lucide="music"></i>
                    <span>CHI TI·∫æT T√ÅC PH·∫®M</span>
                </div>
                <button class="close-modal" id="close-work-modal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="work-detail-section">
                    <label>√ù T∆Ø·ªûNG (CONCEPT)</label>
                    <div id="work-modal-concept" class="lyrics-preview"></div>
                </div>
                <div class="work-detail-section">
                    <label>L·ªúI B√ÄI H√ÅT (LYRICS)</label>
                    <div id="work-modal-lyrics" class="lyrics-preview"></div>
                </div>
                <div class="work-detail-meta" id="work-modal-meta">
                    <!-- Meta tags will be injected here -->
                </div>
            </div>
            <div class="modal-footer" style="padding: 16px; border-top: 1px solid var(--border);">
                <button class="glow-button" id="work-modal-reuse" style="width: 100%;">S·ª¨ D·ª§NG L·∫†I</button>
            </div>
        </div>
    </div>
    <script type="module" src="popup.js"></script>
</body>

</html>